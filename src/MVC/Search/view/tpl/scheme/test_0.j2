<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scheme test</title>

  <script src="/assets/js/lib.js"></script>
  <link rel="stylesheet" href="/assets/vendor/css/bootstrap.css">

<style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #1e1e1e;
    }

    .container {
      position: relative;
      width: 600px;
    }

    .line-numbers {
      position: absolute;
      top: 0;
      left: 0;
      width: 40px;
      height: 100%;
      overflow: hidden;
      background-color: #2d2d2d;
      color: #bbb;
      font-family: monospace;
      text-align: right;
      padding-right: 5px;
      border-right: 1px solid #444;
      user-select: none;
    }

    .line-numbers div {
      line-height: 1.5em;
      height: 1.5em;
    }

    textarea {
      width: 100%;
      height: 300px;
      margin: 0;
      padding-left: 50px;
      border: 1px solid #444;
      background-color: #1e1e1e;
      color: #eee;
      font-family: monospace;
      line-height: 1.5em;
      resize: none;
      overflow: auto;
    }
  </style>

</head>

<body>
  <div class="m-5">
    <div class="row mt-3">
      <div class="col-6">
        <div class="textarea-container">
          <div class="line-numbers" id="line-numbers"></div>
          <textarea class="form-control" id="ta_script" rows="20" placeholder="your script" onscroll="syncScroll()" oninput="updateLineNumbers()"></textarea>
        </div>
      </div>
        <div class="col-6">
            <textarea class="form-control" id="ta_result" rows="20" placeholder="result"></textarea>
        </div>
    </div>
    <div class="row mt-3">
      <textarea class="form-control" id="ta_error" rows="5" placeholder="errors"></textarea>
    </div>
    <div class="row mt-3">
      <div class="col-6">
        <button class="btn btn-primary" id="btn_test">Test</button>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    const elScript = document.getElementById("ta_script")
    const elResult = document.getElementById("ta_result")
    const elError = document.getElementById("ta_error")

    document.getElementById("btn_test").onclick = function(event) {
      if (elScript.value.trim() != '') {
        const post = {'script': elScript.value}
        const res = new TSend().exec(
          '/api/?route=scheme/test',
          {'method': 'Parse', 'post': post}
        )

        elError.value = res['err']
        elResult.value = res['data'] || ''
      } else {
        elError.value = 'empty script'
      }
    }
  </script>

  <script>
    const editor = document.getElementById('ta_script');
    const lineNumbers = document.getElementById('line-numbers');

    // Update line numbers dynamically
    function updateLineNumbers() {
      const lines = editor.value.split('\n').length;
      lineNumbers.innerHTML = Array.from({ length: lines }, (_, i) => `<div>${i + 1}</div>`).join('');
    }

    // Sync the scroll position of line numbers with textarea
    function syncScroll() {
      lineNumbers.scrollTop = editor.scrollTop;
    }

    // Initialize line numbers
    updateLineNumbers();
  </script>

  <script src="/assets/vendor/js/bootstrap.bundle.min.js"></script>
</body>
</html>
