<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Scheme test</title>

    <script src="/assets/js/lib.js"></script>
    <link rel="stylesheet" href="/assets/vendor/css/bootstrap.css">

    <style>
      .textarea-container {
        position: relative;
      }

      .line-numbers {
        position: absolute;
        top: 0;
        left: 0;
        width: 50px;
        padding-top: 0.375rem;
        background-color: #f8f9fa;
        border-right: 1px solid #ced4da;
        overflow: hidden;
        height: 100%;
        font-family: monospace;
        font-size: 0.9rem;
        user-select: none;
        color: #6c757d;
        text-align: right;
      }

      .line-numbers div {
        line-height: 1.5rem;
        height: 1.5rem;
        padding-right: 8px;
      }

      #ta_script {
        padding-left: 60px; /* Space for line numbers */
        line-height: 1.5rem;
        font-family: monospace;
        resize: none;
        overflow: auto;
      }
    </style>
  </head>

  <body>
    <div class="m-5">
      <div class="row mt-3">
        <div class="col-6">
          <div class="textarea-container">
            <div class="line-numbers" id="line-numbers"></div>
            <textarea class="form-control" id="ta_script" rows="20" placeholder="your script"></textarea>
          </div>
        </div>
        <div class="col-6">
          <textarea class="form-control" id="ta_result" rows="20" placeholder="result"></textarea>
        </div>
      </div>
      <div class="row mt-3">
        <textarea class="form-control" id="ta_error" rows="5" placeholder="errors"></textarea>
      </div>
      <div class="row mt-3">
        <div class="col-6">
          <button class="btn btn-primary" id="btn_test">Test</button>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      const elScript = document.getElementById("ta_script");
      const elResult = document.getElementById("ta_result");
      const elError = document.getElementById("ta_error");
      const lineNumbers = document.getElementById("line-numbers");

      // Update line numbers dynamically
      function updateLineNumbers() {
        const lines = elScript.value.split('\n').length;
        let lineHTML = '';
        for (let i = 1; i <= lines; i++) {
          lineHTML += `<div>${i}</div>`;
        }
        lineNumbers.innerHTML = lineHTML;
      }

      // Sync scroll between textarea and line numbers
      function syncScroll() {
        lineNumbers.scrollTop = elScript.scrollTop;
      }

      // Initialize line numbers
      updateLineNumbers();

      // Event listeners for updates
      elScript.addEventListener('input', updateLineNumbers);
      elScript.addEventListener('scroll', syncScroll);

      // Test button logic
      document.getElementById("btn_test").onclick = function(event) {
        if (elScript.value.trim() != '') {
          const post = { 'script': elScript.value };
          const res = new TSend().exec(
            '/api/?route=scheme/test',
            { 'method': 'Parse', 'post': post }
          );

          elError.value = res['err'];
          elResult.value = res['data'] || '';
        } else {
          elError.value = 'empty script';
        }
      };
    </script>

    <script src="/assets/vendor/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
