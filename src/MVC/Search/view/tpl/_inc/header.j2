<!-- header + -->
<div class="logo-and-select">
  <div class="logo">
    <a href="{{href.root}}"><img src="/assets/img/logo-1x1.png" alt="Logo" height="40"></a>
  </div>
  <select class="form-select ms-2 d-md-none">
    <option selected>ua</option>
    <option value="1">ua</option>
    <option value="2">pl</option>
  </select>
</div>

<form method="get" class="search-group ms-3" autocomplete="off" id="viSearchForm">
  <input type="hidden" name="route" value="product/search"/>
  <input type="text" class="form-control search-input" name="q" value="{{search}}" id="viSearchInput" placeholder="{{Translate(lang, 'search')}}">
  <button type="submit" class="search-icon ms-2" aria-label="Search">
    <i class="bi bi-search"></i>
  </button>
  <select class="form-select ms-2 d-none d-md-inline" name="country_id" id="viCountry">
    {% for Rec in TDbList().Import(dbl_country) %}
      <option value="{{Rec.id}}" {{Iif(Rec.id == country_id, 'selected', '')}}>{{Rec.alias}}</option>
    {% endfor %}
  </select>
</form>

<div class="d-flex col-10 col-sm-1 col-md-1 order-2 justify-content-end">
  <button type="button" class="btn btn-success" id="viBtnOn_favorite" value="favorite" title="{{Translate(lang, 'favorite')}}">
    <i class="fa fa-heart"></i>
    <span class="badge vBgBtn" id="viCount_favorite"></span>
  </button>
  <button type="button" class="btn btn-success" id="viBtnOn_compare" value="compare" title="{{Translate(lang, 'compare')}}">
    <i class="fa fa-balance-scale"></i>
    <span class="badge vBgBtn" id="viCount_compare"></span>
  </button>
</div>

<script type="text/javascript">
    LocalDb = new TLocalStorage();

    const elForm = document.getElementById('viSearchForm');
    const elSearch = document.getElementById('viSearchInput');

    document.getElementById('viCountry').addEventListener('change', (event) => {
      const langId = event.target.value;

      const curUrl = window.location.href;
      const urlObj = new URL(curUrl, window.location.origin);
      urlObj.searchParams.set('lang_id', langId);
      newUrl = urlObj.toString();
      //console.log(event.target.value, newUrl);

      LocalDb.addItemToListUniq({'lang_id': langId});
      LocalDb.save();

      const Search = elSearch.value.trim();
      if (Search == '') {
        elForm.querySelector('input[name="route"]').remove();
      }
      //elForm.submit();
  });

  const Hrefs = {
    'compare': '{{href.compare}}',
    'favorite': '{{href.favorite}}'
  }

  for (const key of ['compare', 'favorite']) {
    const LStorage = new TLocalStorage('products_' + key)
    if (LStorage.items) {
      document.getElementById('viCount_' + key).innerHTML = LStorage.items.length
    }

    document.getElementById('viBtnOn_' + key).addEventListener('click', function (event) {
      const value = (event.target.value ? event.target.value : event.target.parentElement.value)
      const LStorage = new TLocalStorage('products_' + value)
      if (LStorage.items && LStorage.items.length > 0) {
        const Url = `${Hrefs[value]}${Hrefs[value].includes('?') ? '&' : '/?'}url_ids=${LStorage.items.join(',')}`;
        window.location.href = Url
      }else{
        showTooltip("{{Translate(lang, 'no_data')}}")
      }
    })
  }

</script>
<!-- header - -->
